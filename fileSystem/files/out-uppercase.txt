'USE STRICT'

CONST { CREATEREADSTREAM, CREATEWRITESTREAM } = REQUIRE('FS')
CONST { JOIN } = REQUIRE('PATH')
CONST { PIPELINE, TRANSFORM } = REQUIRE('STREAM')

CONST CREATEUPPERCASESTREAM = () => (
  NEW TRANSFORM({
    TRANSFORM(CHUNK, ENCODING, NEXT) {
      CONST UPPERCASED = CHUNK.TOSTRING().TOUPPERCASE()

      NEXT(NULL, UPPERCASED)
    }
  })
)

PIPELINE(
  CREATEREADSTREAM(__FILENAME),
  CREATEUPPERCASESTREAM(),
  CREATEWRITESTREAM(JOIN(__DIRNAME, 'OUT-UPPERCASE.TXT')),
  (ERROR) => {
    IF (ERROR) {
      CONSOLE.ERROR(ERROR)
      RETURN
    }

    CONSOLE.LOG('SUCCESS!')
  }
)